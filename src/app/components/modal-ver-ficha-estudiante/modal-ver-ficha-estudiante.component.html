<div style="height: 80vh; position: relative; overflow: auto;">
  <!-- Spinner mientras se carga -->
  <div *ngIf="isLoading" class="spinner-overlay">
    <div class="spinner-box">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Cargando ficha del estudiante...</p>
    </div>
  </div>

  <ng-container *ngIf="!isLoading">
    <!-- Título de la ficha -->
    <h1>Ficha de Estudiante</h1>
    <mat-divider></mat-divider>

    <table class="tabla-ficha-datos mat-elevation-z8" style="width: 50%;">
      <tr>
        <td><strong>N° Matrícula:</strong></td>
        <td>{{ estudiante.id }}</td>
      </tr>
      <tr>
        <td><strong>Nombre Completo:</strong></td>
        <td>{{ estudiante.primer_nombre_alumno }} {{ estudiante.segundo_nombre_alumno }} {{
          estudiante.primer_apellido_alumno }} {{ estudiante.segundo_apellido_alumno }}</td>
      </tr>
      <tr>
        <td><strong>Fecha Nacimiento:</strong></td>
        <td>{{ estudiante.fecha_nacimiento_alumno | date:'dd/MM/yyyy' }}</td>
      </tr>
      <tr>
        <td><strong>Fecha Matrícula:</strong></td>
        <td>{{ estudiante.fecha_matricula | date:'dd/MM/yyyy' }}</td>
      </tr>
      <tr>
        <td><strong>RUT:</strong></td>
        <td>{{ estudiante.rut }}-{{ estudiante.dv }}</td>
      </tr>
      <tr>
        <td><strong>Género:</strong></td>
        <td>
          {{ estudiante.genero_alumno === 'F' ? 'Femenino' :
          estudiante.genero_alumno === 'M' ? 'Masculino' :
          estudiante.genero_alumno }}
        </td>
      </tr>
      <tr>
        <td><strong>Vive con:</strong></td>
        <td>{{ estudiante.vive_con }}</td>
      </tr>
      <tr>
        <td><strong>Previsión:</strong></td>
        <td>{{ estudiante.prevision_alumno }}</td>
      </tr>
      <tr>
        <td><strong>Nacionalidad:</strong></td>
        <td>{{ estudiante.nacionalidad }}</td>
      </tr>
      <tr>
        <td><strong>Consultorio/Clínica:</strong></td>
        <td>{{ estudiante.consultorio_clinica_alumno }}</td>
      </tr>
      <tr>
        <td><strong>Autorización Fotografías:</strong></td>
        <td>{{ estudiante.autorizacion_fotografias ? 'Sí' : 'No' }}</td>
      </tr>
      <tr>
        <td><strong>Estado Estudiante:</strong></td>
        <td>{{ estudiante.estado_estudiante ? 'Activo' : 'Inactivo' }}</td>
      </tr>
    </table>

    <!-- Tabla de Apoderado Titular -->
    <h2>Apoderado Titular</h2>
    <table mat-table [dataSource]="estudiante.apoderados" class="mat-elevation-z8"
      style="width: 100%; margin-bottom: 20px;">
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> ID </th>
        <td mat-cell *matCellDef="let elem"> {{ elem.id }} </td>
      </ng-container>
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef> Nombre </th>
        <td mat-cell *matCellDef="let elem">
          {{ elem.primer_nombre_apoderado }} {{ elem.segundo_nombre_apoderado }}
          {{ elem.primer_apellido_apoderado }} {{ elem.segundo_apellido_apoderado }}
        </td>
      </ng-container>
      <ng-container matColumnDef="rut">
        <th mat-header-cell *matHeaderCellDef> RUT </th>
        <td mat-cell *matCellDef="let elem"> {{ elem.rut }}-{{ elem.dv }} </td>
      </ng-container>
      <ng-container matColumnDef="telefono">
        <th mat-header-cell *matHeaderCellDef> Teléfono </th>
        <td mat-cell *matCellDef="let elem"> {{ elem.telefono_apoderado }} </td>
      </ng-container>
      <ng-container matColumnDef="correo">
        <th mat-header-cell *matHeaderCellDef> Correo </th>
        <td mat-cell *matCellDef="let elem"> {{ elem.correo_apoderado }} </td>
      </ng-container>
      <ng-container matColumnDef="estadoCivil">
        <th mat-header-cell *matHeaderCellDef> Estado Civil </th>
        <td mat-cell *matCellDef="let elem"> {{ elem.estado_civil }} </td>
      </ng-container>
      <ng-container matColumnDef="parentesco">
        <th mat-header-cell *matHeaderCellDef> Parentesco </th>
        <td mat-cell *matCellDef="let elem"> {{ elem.parentesco_apoderado }} </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="['id','nombre','rut','telefono','correo','estadoCivil','parentesco']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['id','nombre','rut','telefono','correo','estadoCivil','parentesco']">
      </tr>
    </table>

    <!-- Tabla de Apoderado Suplente -->
    <h2>Apoderado Suplente</h2>
    <table mat-table [dataSource]="estudiante.apoderadosSuplentes" class="mat-elevation-z8" style="width: 100%;">
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> ID </th>
        <td mat-cell *matCellDef="let elem"> {{ elem.id }} </td>
      </ng-container>
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef> Nombre </th>
        <td mat-cell *matCellDef="let elem">
          {{ elem.primer_nombre_apoderado_suplente }} {{ elem.segundo_nombre_apoderado_suplente }}
          {{ elem.primer_apellido_apoderado_suplente }} {{ elem.segundo_apellido_apoderado_suplente }}
        </td>
      </ng-container>
      <ng-container matColumnDef="rut">
        <th mat-header-cell *matHeaderCellDef> RUT </th>
        <td mat-cell *matCellDef="let elem"> {{ elem.rut_apoderado_suplente }}-{{ elem.dv_apoderado_suplente }} </td>
      </ng-container>
      <ng-container matColumnDef="telefono">
        <th mat-header-cell *matHeaderCellDef> Teléfono </th>
        <td mat-cell *matCellDef="let elem"> {{ elem.telefono_apoderado_suplente }} </td>
      </ng-container>
      <ng-container matColumnDef="correo">
        <th mat-header-cell *matHeaderCellDef> Correo </th>
        <td mat-cell *matCellDef="let elem"> {{ elem.correo_apoderado_suplente || 'Sin Correo' }} </td>
      </ng-container>
      <ng-container matColumnDef="estadoCivil">
        <th mat-header-cell *matHeaderCellDef> Estado Civil </th>
        <td mat-cell *matCellDef="let elem"> {{ elem.estado_civil_suplente }} </td>
      </ng-container>
      <ng-container matColumnDef="parentesco">
        <th mat-header-cell *matHeaderCellDef> Parentesco </th>
        <td mat-cell *matCellDef="let elem"> {{ elem.parentesco_apoderado_suplente }} </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="['id','nombre','rut','telefono','correo','estadoCivil','parentesco']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['id','nombre','rut','telefono','correo','estadoCivil','parentesco']">
      </tr>
    </table>

    <!-- Botón para cerrar -->
    <div style="margin-top: 20px; text-align: right;">
      <button mat-raised-button color="primary" (click)="closeModal()">Cerrar</button>
    </div>
  </ng-container>
</div>
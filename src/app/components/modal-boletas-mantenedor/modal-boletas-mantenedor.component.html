<h1 mat-dialog-title class="modal-title d-flex justify-content-between align-items-center">
    <p><b>Apoderado: </b>{{ apoderado?.primer_nombre_apoderado }} {{ apoderado?.segundo_nombre_apoderado
        }} {{ apoderado?.primer_apellido_apoderado }} {{ apoderado?.segundo_apellido_apoderado }}</p>
    <button mat-icon-button (click)="closeModal()">
        <mat-icon>close</mat-icon>
    </button>
</h1>
<div class="table-container">

    <mat-card class="apoderado-card">
        <mat-card-content>
            <div class="apoderado-info">
                <p><strong>RUT: </strong> {{ apoderado?.rut }}-{{ apoderado?.dv }}</p>
                <p><strong>Teléfono: </strong> {{ apoderado?.telefono_apoderado }}</p>
                <p><strong>Email: </strong> {{ apoderado?.correo_apoderado }}</p>
                <p><strong>Dirección: </strong> {{ apoderado?.direccion }}, {{ apoderado?.comuna }}</p>
            </div>
        </mat-card-content>
    </mat-card>

    <mat-divider></mat-divider>


    <!-- Tabla para estudiantes -->
    <mat-card class="mb-1">
        <h3 class="estudiantes-title">Estudiantes Asociados</h3>
        <table mat-table [dataSource]="apoderado?.estudiantes" class="mat-elevation-z8 estudiantes-table">

            <!-- ID Column -->
            <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef> ID </th>
                <td mat-cell *matCellDef="let estudiante"> {{ estudiante.id }} </td>
            </ng-container>

            <!-- Nombre Column -->
            <ng-container matColumnDef="nombre">
                <th mat-header-cell *matHeaderCellDef> Nombre Completo </th>
                <td mat-cell *matCellDef="let estudiante">
                    {{ estudiante.primer_nombre_alumno }} {{ estudiante.segundo_nombre_alumno }} {{
                    estudiante.primer_apellido_alumno }} {{ estudiante.segundo_apellido_alumno }}
                </td>
            </ng-container>

            <!-- Rut Column -->
            <ng-container matColumnDef="rut">
                <th mat-header-cell *matHeaderCellDef> RUT </th>
                <td mat-cell *matCellDef="let estudiante"> {{ estudiante.rut }}-{{ estudiante.dv }} </td>
            </ng-container>

            <!-- Fecha de Nacimiento Column -->
            <ng-container matColumnDef="fecha_nacimiento">
                <th mat-header-cell *matHeaderCellDef> Fecha de Nacimiento </th>
                <td mat-cell *matCellDef="let estudiante"> {{ estudiante.fecha_nacimiento_alumno | date }} </td>
            </ng-container>

            <!-- Observaciones Column -->
            <ng-container matColumnDef="observaciones">
                <th mat-header-cell *matHeaderCellDef> Observaciones </th>
                <td mat-cell *matCellDef="let estudiante"> {{ estudiante.observaciones_alumno }} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['id', 'nombre', 'rut', 'fecha_nacimiento', 'observaciones']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['id', 'nombre', 'rut', 'fecha_nacimiento', 'observaciones'];">
            </tr>
        </table>
    </mat-card>

    <mat-card>
        <h3 class="estudiantes-title">Boletas</h3>

        <!-- Mostrar mensaje si no hay boletas en dataSource -->
        <div *ngIf="!dataSource || dataSource.data.length === 0" class="empty-message">
            El apoderado no tiene boletas asignadas
        </div>

        <!-- Mostrar tabla si hay boletas en dataSource -->
        <table *ngIf="dataSource && dataSource.data.length > 0" mat-table [dataSource]="dataSource"
            class="mat-elevation-z8 estudiantes-table">

            <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef> ID </th>
                <td mat-cell *matCellDef="let boleta"> {{ boleta.id }} </td>
            </ng-container>

            <ng-container matColumnDef="rut_apoderado">
                <th mat-header-cell *matHeaderCellDef> RUT Apoderado </th>
                <td mat-cell *matCellDef="let boleta"> {{ boleta.rut_apoderado }} </td>
            </ng-container>

            <ng-container matColumnDef="rut_estudiante">
                <th mat-header-cell *matHeaderCellDef> RUT Estudiante </th>
                <td mat-cell *matCellDef="let boleta"> {{ boleta.rut_estudiante }} </td>
            </ng-container>

            <ng-container matColumnDef="detalle">
                <th mat-header-cell *matHeaderCellDef> Detalle </th>
                <td mat-cell *matCellDef="let boleta"> {{ boleta.detalle }} </td>
            </ng-container>

            <ng-container matColumnDef="total">
                <th mat-header-cell *matHeaderCellDef> Total </th>
                <td mat-cell *matCellDef="let boleta"> {{ boleta.total | currency:'CLP':'symbol':'1.0-0' }} </td>
            </ng-container>

            <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Acciones </th>
                <td mat-cell *matCellDef="let element" class="text-center">
                    <button class="boton2 mx-3" (click)="editarBoleta(element.rut)">Editar</button>
                    <button class="boton" (click)="verBoletas(element.rut)">Ver</button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
    </mat-card>
</div>